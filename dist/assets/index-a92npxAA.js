var rt=Object.defineProperty;var at=(m,t,e)=>t in m?rt(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var r=(m,t,e)=>at(m,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class ct{constructor(t,e,o,i,s){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"text");r(this,"text_size");r(this,"state");t.font=l.label.font_size+"px "+l.font,t.textBaseline="middle";const n=t.measureText(s),a=n.width,h=n.fontBoundingBoxAscent+n.fontBoundingBoxDescent;this.bbox={left:i.x,top:i.y,right:i.x+a,bottom:i.y+h},this.text=s,this.action_type=e,this.text_size=l.label.font_size,this.state=0,this.loc=o}render(t){let e=_.string(_.white);this.state==1&&(e=l.widget.hover_bg_color),t.font=this.text_size+"px "+l.font,t.fillStyle=e,t.textBaseline="middle",t.textAlign="center";const o=(this.bbox.left+this.bbox.right)/2,i=(this.bbox.top+this.bbox.bottom)/2-d.calcHeight(this.bbox)/4;t.fillText(this.text,o,i)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y];return d.isInside(this.bbox,e,o)&&this.action_type!=null&&(this.state=1),this.state==1?{wants_focus:t.mouse_frame.clicked,action:this.action_type}:{wants_focus:!1,action:null}}}var E=(m=>(m[m.default=0]="default",m[m.hovered=1]="hovered",m[m.clicked=2]="clicked",m[m.down=3]="down",m[m.released=4]="released",m))(E||{});class et{constructor(t,e,o,i,s,n,a){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"text");r(this,"state");t.font=l.button.font_size+"px "+l.font,t.textBaseline="middle";const h=t.measureText(s),w=h.width+2*l.button.padding,u=n!=null&&n>w?n:w,x=h.fontBoundingBoxAscent+h.fontBoundingBoxDescent+2*l.button.padding,p=a!=null&&a>x?a:x;this.bbox={left:i.x,top:i.y,right:i.x+u,bottom:i.y+p},this.text=s,this.action_type=e,this.state=0,this.loc=o}render(t){let e=l.widget.default_bg_color;this.state==1&&(e=l.widget.hover_bg_color),this.state==2&&(e=l.widget.down_bg_color),this.state==3&&(e=l.widget.down_bg_color),this.state==4&&(e=l.widget.down_bg_color),t.fillStyle=e,t.fillRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),t.font=`normal ${l.button.font_size}px ${l.font}`,t.fillStyle=_.string(_.white),t.textBaseline="middle",t.textAlign="center";const o=(this.bbox.left+this.bbox.right)/2,i=(this.bbox.top+this.bbox.bottom)/2-l.button.font_size*.25;t.fillText(this.text,o,i)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y];if(d.isInside(this.bbox,e,o)){const i=JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc);t.mouse_frame.clicked?(this.state=2,t.active_widget_loc=JSON.parse(JSON.stringify(this.loc))):i&&t.mouse_frame.released?this.state=4:i&&t.mouse_down?this.state=3:this.state=1}return this.state==2||this.state==3?{wants_focus:!0,action:null}:this.state==4?{wants_focus:!1,action:this.action_type}:{wants_focus:!1,action:null}}}class it{constructor(t,e,o,i,s,n){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"text");r(this,"state");t.font=l.button.font_size+"px "+l.font,t.textBaseline="middle";const a=t.measureText(s),h=a.width,w=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent;this.bbox={left:i.x,top:i.y,right:i.x+(n||h+2*l.button.padding),bottom:i.y+w+2*l.button.padding},this.text=s,this.action_type=e,this.state=0,this.loc=o}render(t){let e=l.widget.default_bg_color;this.state==1&&(e=l.widget.hover_bg_color),this.state==2&&(e=l.widget.down_bg_color),this.state==3&&(e=l.widget.down_bg_color),this.state==4&&(e=l.widget.down_bg_color),t.fillStyle=e,t.fillRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),t.font="lighter "+l.button.font_size+"px "+l.font,t.fillStyle=_.string(_.white),t.textBaseline="middle",t.textAlign="center";const o=Math.round((this.bbox.left+this.bbox.right)/2)+.5,i=Math.round((this.bbox.top+this.bbox.bottom)/2-l.button.font_size*.25)+.5;t.fillText(this.text,o,i)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y],i=d.isInside(this.bbox,e,o);return i&&t.mouse_frame.clicked?(this.state=2,t.active_widget_loc=JSON.parse(JSON.stringify(this.loc))):JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_frame.released?this.state=4:JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_down?this.state=3:i&&(this.state=1),this.state==2||this.state==3?{wants_focus:!0,action:this.action_type}:this.state==4?{wants_focus:!1,action:null}:{wants_focus:!1,action:null}}}class ht{constructor(t,e,o,i,s,n){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"text");r(this,"text_size");r(this,"max_width");r(this,"state");r(this,"wrapped_lines");t.font=l.label.font_size+"px "+l.font,t.textBaseline="middle",this.max_width=n,this.text=s,this.action_type=e,this.text_size=l.label.font_size,this.state=0,this.loc=o,this.wrapped_lines=this.wrapText(t,s,n);let a=0;for(let u=0;u<this.wrapped_lines.length;u++){const x=t.measureText(this.wrapped_lines[u]).width;a<x&&(a=x)}const h=this.text_size*1.2,w=this.wrapped_lines.length*h;this.bbox={left:i.x,top:i.y,right:i.x+a,bottom:i.y+w}}wrapText(t,e,o){const i=e.split(" "),s=[];let n="";for(let a of i){const h=n+(n?" ":"")+a;t.measureText(h).width>o?(n&&s.push(n),n=a):n=h}return n&&s.push(n),s}render(t){let e=_.string(_.white);this.state==1&&(e=l.widget.hover_bg_color),t.font=this.text_size+"px "+l.font,t.fillStyle=e,t.textBaseline="middle",t.textAlign="left";const o=this.text_size*1.2;let i=this.bbox.top+o/2-.25*this.text_size;for(let s of this.wrapped_lines){const n=this.bbox.left;t.fillText(s,n,i),i+=o}}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y];return d.isInside(this.bbox,e,o)&&this.action_type!=null&&(this.state=1),this.state==1?{wants_focus:t.mouse_frame.clicked,action:this.action_type}:{wants_focus:!1,action:null}}}class dt{constructor(t,e,o,i,s,n){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"color");this.color=i,this.bbox={left:o.x,top:o.y,right:o.x+s,bottom:o.y+n},this.action_type=t,this.loc=e}render(t){const e=d.calcWidth(this.bbox),o=d.calcHeight(this.bbox),i=_.toHSVA(this.color),s={h:i.h,s:i.s,v:i.v,a:i.a};s.s=1,s.v=1;const n=_.string(_.fromHSVA(s.h,s.s,s.v,s.a)),a=t.createLinearGradient(this.bbox.left,this.bbox.top,this.bbox.right,this.bbox.top);a.addColorStop(0,"white"),a.addColorStop(1,n),t.fillStyle=a,t.fillRect(this.bbox.left,this.bbox.top,e,o);const h=t.createLinearGradient(this.bbox.left,this.bbox.top,this.bbox.left,this.bbox.bottom);h.addColorStop(0,"rgba(0, 0, 0, 0)"),h.addColorStop(1,"rgba(0, 0, 0, 1)"),t.fillStyle=h,t.fillRect(this.bbox.left,this.bbox.top,e,o);const w=i.s*e+this.bbox.left,u=(1-i.v)*o+this.bbox.top;t.beginPath(),t.arc(w,u,5,0,2*Math.PI),t.fillStyle=_.string(this.color),t.fill(),t.lineWidth=3,t.strokeStyle="black",t.stroke(),t.lineWidth=2,t.strokeStyle="white",t.stroke(),t.closePath()}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y];if(d.isInside(this.bbox,e,o)&&t.mouse_frame.clicked&&(t.active_widget_loc=this.loc),JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_down){const n=d.calcWidth(this.bbox),a=d.calcHeight(this.bbox),h=L=>Math.min(Math.max(L,.0015),.999),w=h((e-this.bbox.left)/n),u=h(1-(o-this.bbox.top)/a),x=_.toHSVA(this.color);let p;if(u===0)p=_.fromHSVA(x.h,w,0,this.color.a);else if(w===0)p=_.fromHSVA(x.h,0,u,this.color.a);else{const L=_.toHSVA(this.color);p=_.fromHSVA(L.h,w,u,this.color.a)}return this.color=p,{wants_focus:!0,action:this.action_type}}return{wants_focus:!1,action:null}}}class T{constructor(t,e,o,i,s,n){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"widgets");r(this,"cursor");this.cursor={x:o+l.layout_commons.padding,y:i},this.bbox={left:o,top:i,right:o+s,bottom:i+n},this.action_type=t,this.loc=e,this.widgets=[]}pushWidget(t){this.widgets.push(t)}render(t){for(let e=this.widgets.length-1;e>=0;e--)this.widgets[e].render(t)}requestAction(t){const e=n=>{if(t.active_widget_loc.length===0)return!0;const a=t.active_widget_loc.slice(0,n.loc.length);return a.length===n.loc.length&&a.every((h,w)=>h===n.loc[w])},[o,i]=[t.mouse_position.x,t.mouse_position.y],s=d.isInside(this.bbox,o,i);if(!s&&t.active_widget_loc.length==0)return{iters:null,wants_focus:!1,action:null};if(!t.moving_window)for(let n=0;n<this.widgets.length;n++){const a=this.widgets[n];if(!e(a))continue;const h=a.requestAction(t);if(h.wants_focus||h.action!=null||!(a instanceof T)&&d.isInside(a.bbox,o,i)&&a.action_type!=null&&!(a instanceof C))return{iters:n,wants_focus:h.wants_focus,action:h.action}}return t.active_widget_loc.length>1&&JSON.stringify(t.active_widget_loc)!=JSON.stringify(this.loc)?(t.active_widget_loc=[],{iters:null,wants_focus:!1,action:null}):this.action_type==null?{iters:null,wants_focus:!1,action:null}:(s&&t.mouse_frame.clicked&&(t.moving_window=!0,t.active_widget_loc=this.loc),t.moving_window&&t.mouse_frame.released&&(t.moving_window=!1,t.active_widget_loc=[]),{iters:null,wants_focus:!1,action:null})}makeLabel(t,e,o){const i=new ct(t,e,this.loc.concat([this.widgets.length]),this.cursor,o);return this.pushWidget(i),i}makeButton(t,e,o,i){const s=new et(t,e,this.loc.concat([this.widgets.length]),this.cursor,o,i==null?void 0:i.width,i==null?void 0:i.height);return this.pushWidget(s),s}makeDraggable(t,e,o,i){const s=new it(t,e,this.loc.concat([this.widgets.length]),this.cursor,o,i==null?void 0:i.width);return this.pushWidget(s),s}makeText(t,e,o,i){const s=new ht(t,e,this.loc.concat([this.widgets.length]),this.cursor,o,i??d.calcWidth(this.bbox)-2*l.layout_commons.padding);return this.pushWidget(s),s}makeColorPickerRect(t,e,o,i){const s=new dt(t,this.loc.concat([this.widgets.length]),this.cursor,e,o,i);return this.pushWidget(s),s}resetCursor(){this.cursor.x=this.bbox.left+2*l.layout_commons.widget_gap,this.cursor.y=this.widgets[this.widgets.length-1].bbox.bottom+l.layout_commons.widget_gap}}class C{constructor(t,e,o,i,s,n){r(this,"bbox");r(this,"action_type");r(this,"loc");r(this,"widgets");r(this,"title");r(this,"title_font_size");r(this,"window_state");this.action_type=e,this.title=o,this.title_font_size=l.header_commons.font_size,this.bbox={left:i,top:s,right:i+n,bottom:s+l.header_commons.font_size},this.loc=t,this.widgets=[],this.window_state="open"}render(t){t.fillStyle=this.window_state=="open"?l.header_commons.bg_color:l.window.minimized_header_bg,t.fillRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),t.font=this.title_font_size+"px "+l.font,t.fillStyle=l.header_commons.color,t.textBaseline="middle",t.textAlign="left";const e=this.bbox.left+l.layout_commons.widget_gap,o=(this.bbox.top+this.bbox.bottom)/2-d.calcHeight(this.bbox)/4;t.fillText(this.title,e,o)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,o]=[t.mouse_position.x,t.mouse_position.y];return d.isInside(this.bbox,e,o)&&t.mouse_frame.double_clicked?{wants_focus:!1,action:this.action_type}:{wants_focus:!1,action:null}}}class G extends it{constructor(t,e,o,i,s){super(t,e,o,i,s)}}class Y extends et{constructor(t,e,o,i){super(t,e,o,i,"x")}render(t){let e=l.widget.default_bg_color;this.state==E.hovered&&(e=l.widget.hover_bg_color),this.state==E.clicked&&(e=l.widget.down_bg_color),this.state==E.down&&(e=l.widget.down_bg_color),this.state==E.released&&(e=l.widget.down_bg_color);const o=(this.bbox.left+this.bbox.right)/2;let i=(this.bbox.top+this.bbox.bottom)/2;t.fillStyle=e,t.beginPath(),t.arc(o,i,.5*l.button.font_size,0,2*Math.PI),t.fill(),t.closePath(),i-=l.button.font_size*.35,t.font=`normal ${1.25*l.button.font_size}px ${l.font}`,t.fillStyle=_.string(_.white),t.textBaseline="middle",t.textAlign="center",t.fillText(this.text,o,i)}}class q extends T{constructor(e,o,i,s,n,a,h,w,u,x,p,L){super(o,a,h,w,u,x);r(this,"min_size");r(this,"header_height");r(this,"offset");r(this,"mode");r(this,"tools");this.offset=0,this.mode="normal",this.tools={min_width:0,max_width:d.calcWidth(this.bbox)};const F=this.loc.concat([]);F.push(this.widgets.length),s!=null&&this.widgets.push(new G(e,s,F,{x:this.bbox.right-27,y:this.bbox.bottom-20},"res"));const N=this.loc.concat([]);N.push(this.widgets.length),n!=null&&this.widgets.push(new Y(e,n,N,{x:this.bbox.right-15,y:this.bbox.top-2.5}));const R=a.concat([]);R.push(this.widgets.length);const D=new C(R,i,p,this.cursor.x,this.cursor.y,10);this.widgets.push(D),this.cursor.y+=d.calcHeight(D.bbox)+l.layout_commons.widget_gap,this.header_height=d.calcHeight(D.bbox),this.min_size=L,D.bbox.left=this.bbox.left,D.bbox.right=this.bbox.right}updateBBox(){}setMode(e,o){switch(this.mode=e,this.mode){case"normal":break;case"two columns":this.offset=this.widgets.length,o!=null&&(this.tools.min_width=o.min_width!=null?o.min_width:this.tools.min_width,this.tools.max_width=o.max_width!=null?o.max_width:this.tools.max_width);break}}pushWidget(e){switch(super.pushWidget(e),this.mode){case"normal":this.cursor.y+=d.calcHeight(e.bbox)+l.layout_commons.widget_gap;break;case"two columns":if((this.widgets.length-this.offset)%2==0){this.cursor.x=this.bbox.left+l.layout_commons.padding;const o=this.widgets.length-1,i=Math.max(d.calcHeight(this.widgets[o].bbox),d.calcHeight(this.widgets[o-1].bbox));this.cursor.y+=i+l.layout_commons.widget_gap}else this.cursor.x+=Math.min(this.tools.max_width,Math.max(this.tools.min_width,d.calcWidth(this.bbox)))/2;break}}render(e){e.save();const o=l.layout_commons.border_width;e.beginPath(),e.rect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),e.closePath(),e.fillStyle=_.string(l.layout_commons.bg_color),e.fillRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),e.strokeStyle=l.layout_commons.border,e.lineWidth=o,e.strokeRect(this.bbox.left-.5*o,this.bbox.top-.5*o,d.calcWidth(this.bbox)+o,d.calcHeight(this.bbox)+o),e.clip(),super.render(e),e.restore()}requestAction(e){return e.mouse_position.x,{minimise:!1,close:!1,resize:!1,iters:null,wants_focus:!1,action:null}}requestWindowAction(e,o){const i=super.requestAction(o);return i.iters==null?{minimise:!1,close:!1,resize:!1,...i}:this.widgets[i.iters]instanceof C?{minimise:i.action!=null,close:!1,resize:!1,...i}:this.widgets[i.iters]instanceof G&&!e?{minimise:!1,close:!1,resize:i.action!=null,...i}:this.widgets[i.iters]instanceof Y?{minimise:!1,close:i.action!=null,resize:!1,...i}:e?{minimise:!1,close:!1,resize:!1,iters:null,wants_focus:!1,action:null}:{minimise:!1,close:!1,resize:!1,...i}}}class mt extends T{constructor(e,o,i,s,n,a){super(e,o,i,s,n,0);r(this,"columns");this.columns=a}updateBBox(e){const o=l.layout_commons.padding;e.bbox.top<this.bbox.top+o&&(this.bbox.top=e.bbox.top-o),e.bbox.bottom>this.bbox.bottom-o&&(this.bbox.bottom=e.bbox.bottom+o)}pushWidget(e){if(super.pushWidget(e),this.updateBBox(e),this.widgets.length%this.columns==0){let i=Number.NEGATIVE_INFINITY;for(let s=this.widgets.length-this.columns;s<this.widgets.length;s++)this.widgets[s].bbox.bottom>i&&(i=this.widgets[s].bbox.bottom);this.cursor.x=this.bbox.left+l.layout_commons.padding,this.cursor.y=i+l.layout_commons.widget_gap;return}this.cursor.x+=d.calcWidth(this.bbox)/this.columns}render(e){e.fillStyle=_.string(l.layout_commons.bg_color),e.fillRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),e.strokeStyle=l.layout_commons.border,e.lineWidth=1,e.strokeRect(this.bbox.left,this.bbox.top,d.calcWidth(this.bbox),d.calcHeight(this.bbox)),super.render(e)}requestAction(e){const o=i=>{if(e.active_widget_loc.length===0)return!0;const s=e.active_widget_loc.slice(0,i.loc.length);return s.length===i.loc.length&&s.every((n,a)=>n===i.loc[a])};if(!e.moving_window)for(let i=0;i<this.widgets.length;i++){const s=this.widgets[i];if(!o(s))continue;const n=s.requestAction(e);if(n.wants_focus||n.action!=null)return{iters:i,...n}}return{iters:null,wants_focus:!1,action:null}}}class U{constructor(){r(this,"bbox");r(this,"widgets");this.bbox={left:0,right:0,top:0,bottom:0},this.widgets=[]}render(t){t.lineWidth=1}stack_render(t,e){for(let o=e.window_order.length-1;o>=0;o--){const i=e.window_order[o];e.window_active[i]&&this.widgets[i].render(t)}}makeWindow(t,e,o,i){const s=this.widgets.length;e.window_offsets.length<=this.widgets.length&&(e.window_offsets.push({x:0,y:0}),e.window_positions.push({x:i.x??0,y:i.y??0}),e.window_sizes.push({width:i.width??200,height:i.height??200}),e.window_active.push(!0),e.window_minimised.push(!1),e.window_order.unshift(s));const n=new q(t,o.window,o.header,o.resizeable,o.close_btn,[s],e.window_positions[s].x,e.window_positions[s].y,e.window_sizes[s].width,e.window_sizes[s].height,i.title??"Hello, World!",{width:i.min_width??50,height:i.min_height??20});return this.widgets.push(n),n}static makeGrid(t,e,o,i){const s=new mt(e,t.loc.concat([t.widgets.length]),t.cursor.x,t.cursor.y+l.layout_commons.padding,i*(t.bbox.right-t.bbox.left-2*l.layout_commons.padding),o);return t.pushWidget(s),s}endEditing(t){for(let e=0;e<this.widgets.length;e++){const o=this.widgets[e];if(t.window_active[e]&&t.window_minimised[e]&&o instanceof q){o.bbox.bottom=o.bbox.top+o.header_height;for(let i=0;i<=2;i++)if(o.widgets[i]instanceof C){o.widgets[i].window_state="minimised";break}}}}requestAction(t){this.endEditing(t);for(let e=0;e<t.window_order.length;e++){const o=t.window_order[e],i=this.widgets[o];if(t.mouse_frame.released&&(t.resizing_window=!1,document.body.style.cursor="default"),!t.window_active[o])continue;const s=i instanceof q?i.requestWindowAction(t.window_minimised[o],t):i.requestAction(t);s.wants_focus&&(t.window_order.splice(e,1),t.window_order.unshift(o));const n=s;if(i instanceof q&&n.iters!=null){if(n.resize&&(t.resizing_window=!0,document.body.style.cursor="nwse-resize"),t.resizing_window&&JSON.stringify(t.active_widget_loc)==JSON.stringify(i.widgets[n.iters].loc)){t.window_sizes[o].width+=t.window_sizes[o].width<i.min_size.width&&t.mouse_delta_pos.x<0?0:t.mouse_delta_pos.x,t.window_sizes[o].height+=t.window_sizes[o].height<i.min_size.height&&t.mouse_delta_pos.y<0?0:t.mouse_delta_pos.y;break}n.close&&(t.window_active[o]=!1),n.minimise&&(t.window_minimised[o]=!t.window_minimised[o]),t.window_minimised[o]&&(i.bbox.bottom=i.bbox.top+d.calcHeight(i.widgets[n.iters].bbox))}if(document.body.style.cursor="default",t.moving_window&&JSON.stringify(t.active_widget_loc)===JSON.stringify(i.loc)){t.mouse_frame.clicked?(t.window_order.splice(e,1),t.window_order.unshift(o),t.window_offsets[o].x=i.bbox.left-t.mouse_position.x,t.window_offsets[o].y=i.bbox.top-t.mouse_position.y):t.mouse_down&&(t.window_positions[o].x=t.window_offsets[o].x+t.mouse_position.x,t.window_positions[o].y=t.window_offsets[o].y+t.mouse_position.y);break}if(!(s.action==null&&(!d.isInside(i.bbox,t.mouse_position.x,t.mouse_position.y)||t.moving_window)))return t.mouse_frame.released&&(t.active_widget_loc=[]),s}return{wants_focus:!1,action:null}}}const v=document.createElement("canvas");v.id="nirf_canvas";document.body.appendChild(v);function bt(){v.width=window.innerWidth,v.height=window.innerHeight,v.style.width=window.innerWidth+"px",v.style.height=window.innerHeight+"px"}function W(m,t){return Math.floor(m*10**t)/10**t}function _t(m,t){let e=m%t;return e<0&&(e+=t),e}function B(m,t,e,o){(o==null?void 0:o.min)!=null&&(o==null?void 0:o.max)!=null&&console.assert(o.min<o.max);let i=m+e*t.mouse_delta_pos.x;return(o==null?void 0:o.min)!=null&&i<(o==null?void 0:o.min)&&(i=o.min),(o==null?void 0:o.max)!=null&&i>(o==null?void 0:o.max)&&(i=o==null?void 0:o.max),i}class _{static string(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`}static fromString(t){const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*(\d*\.?\d+)?\)/);if(!e)throw new Error("Invalid color string format");const[,o,i,s,n]=e;return{r:parseInt(o,10),g:parseInt(i,10),b:parseInt(s,10),a:n!==void 0?parseFloat(n):1}}static fromHex(t){const e=t.replace("#","");if(e.length===6){const o=parseInt(e.slice(0,2),16),i=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);return{r:o,g:i,b:s,a:1}}else if(e.length===8){const o=parseInt(e.slice(0,2),16),i=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16)/255;return{r:o,g:i,b:s,a:n}}else throw new Error("Invalid hex color format")}static toHex(t){const e=Math.round(t.r).toString(16).padStart(2,"0"),o=Math.round(t.g).toString(16).padStart(2,"0"),i=Math.round(t.b).toString(16).padStart(2,"0"),s=Math.round(t.a*255).toString(16).padStart(2,"0");return t.a===1?`#${e}${o}${i}`:`#${e}${o}${i}${s}`}static fromRGB(t){return{...t,a:1}}static fromHSVA(t,e,o,i){const s=_t(t,360),n=o*e,a=n*(1-Math.abs(s/60%2-1)),h=o-n;let[w,u,x]=[0,0,0];return 0<=s&&s<60?[w,u,x]=[n,a,0]:60<=s&&s<120?[w,u,x]=[a,n,0]:120<=s&&s<180?[w,u,x]=[0,n,a]:180<=s&&s<240?[w,u,x]=[0,a,n]:240<=s&&s<300?[w,u,x]=[a,0,n]:300<=s&&s<360&&([w,u,x]=[n,0,a]),[w,u,x]=[255*(w+h),255*(u+h),255*(x+h)],{r:W(w,this.EPS_DECIMALS),g:W(u,this.EPS_DECIMALS),b:W(x,this.EPS_DECIMALS),a:i}}static toHSVA(t){const e=t.r/255,o=t.g/255,i=t.b/255,s=Math.max(e,o,i),n=Math.min(e,o,i),a=s-n;let h=0;a==0?h=0:s===e?h=(60*((o-i)/a)+360)%360:s===o?h=(60*((i-e)/a)+120)%360:s===i&&(h=(60*((e-o)/a)+240)%360);const w=s===0?0:a/s,u=s;return{h:W(h,this.EPS_DECIMALS),s:W(w,this.EPS_DECIMALS),v:W(u,this.EPS_DECIMALS),a:t.a}}}r(_,"white",{r:255,g:255,b:255,a:1}),r(_,"black",{r:0,g:0,b:0,a:1}),r(_,"g_18",{r:18,g:19,b:18,a:1}),r(_,"red",{r:255,g:0,b:0,a:1}),r(_,"default_bg"),r(_,"EPS_DECIMALS",6);class d{static isInside(t,e,o){return e>t.left&&e<t.right&&o>t.top&&o<t.bottom}static calcWidth(t){return t.right-t.left}static calcHeight(t){return t.bottom-t.top}static set(t,e){t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom}}class l{}r(l,"font","ProggyCleanTT"),r(l,"widget",{default_bg_color:"#294A7AFF",hover_bg_color:"#4296FAFF",down_bg_color:"#0F87FAFF"}),r(l,"label",{font_size:16,default_font_color:_.white,inactive_font_color:_.fromHex("#808080FF")}),r(l,"button",{padding:3,font_size:16}),r(l,"layout_commons",{padding:10,widget_gap:5,bg_color:_.fromHex("#0F0F0FF0"),border:"#6E6E8080",border_width:1}),r(l,"header_commons",{color:"#ffffff",bg_color:"#294A7AFF",font_size:16}),r(l,"window",{minimized_header_bg:"#9F9F9F09"}),r(l,"grid",{}),r(l,"popup",{});class wt{constructor(t,e,o){r(this,"mouse_position");r(this,"mouse_prev_position");r(this,"mouse_delta_pos");r(this,"mouse_down_position");r(this,"mouse_down");r(this,"mouse_frame");r(this,"moving_window");r(this,"resizing_window");r(this,"window_offsets");r(this,"window_positions");r(this,"window_sizes");r(this,"window_active");r(this,"window_minimised");r(this,"window_order");r(this,"active_widget_loc");r(this,"last_click_time");r(this,"double_click_threshold");this.mouse_position={x:e,y:o},this.mouse_prev_position={x:e,y:o},this.mouse_down_position={x:e,y:o},this.mouse_delta_pos={x:e,y:o},this.mouse_down=!1,this.mouse_frame={clicked:!1,time_at_click:-1,time_since_click:0,double_clicked:!1,released:!1},this.moving_window=!1,this.resizing_window=!1,this.window_offsets=[],this.window_positions=[],this.window_sizes=[],this.window_active=[],this.window_minimised=[],this.window_order=[],this.active_widget_loc=[],this.last_click_time=-1,this.double_click_threshold=300,t.addEventListener("mousemove",i=>{const s=t.getBoundingClientRect(),n=i.clientX-s.x,a=i.clientY-s.y;this.mouse_position.x=n,this.mouse_position.y=a}),t.addEventListener("mousedown",i=>{const s=t.getBoundingClientRect(),n=i.clientX-s.x,a=i.clientY-s.y;this.mouse_down_position.x=n,this.mouse_down_position.y=a;const h=performance.now();this.mouse_frame.clicked=!0,this.last_click_time!==-1&&h-this.last_click_time<this.double_click_threshold?this.mouse_frame.double_clicked=!0:(this.mouse_frame.double_clicked=!1,h-this.last_click_time>=this.double_click_threshold&&(this.last_click_time=-1)),this.last_click_time=h,this.mouse_down=!0}),t.addEventListener("mouseup",()=>{this.mouse_frame.released=!0,this.mouse_down=!1})}end(){this.mouse_delta_pos.x=this.mouse_position.x-this.mouse_prev_position.x,this.mouse_delta_pos.y=this.mouse_position.y-this.mouse_prev_position.y,this.mouse_prev_position.x=this.mouse_position.x,this.mouse_prev_position.y=this.mouse_position.y;const t=performance.now();this.mouse_frame.time_at_click!==-1&&(this.mouse_frame.time_since_click=t-this.mouse_frame.time_at_click),this.mouse_frame.clicked&&(this.mouse_frame.time_at_click=t),t-this.last_click_time>=this.double_click_threshold&&(this.mouse_frame.time_at_click=-1,this.mouse_frame.time_since_click=0,this.last_click_time=-1),this.mouse_frame.clicked=!1,this.mouse_frame.released=!1,this.mouse_frame.double_clicked=!1}}const c=v.getContext("2d"),f=new wt(v,0,0);let A=0,X=-1,K=0,j=-1,$=1,Q=-1,Z=-1,tt=-1,H=400,g=_.fromHex("#738C99");function ot(){document.body.style.backgroundColor=_.string(g);let m=null;const t=performance.now();bt();const e=new U,o=performance.now(),i=e.makeWindow(c,f,{window:0,header:0,resizeable:0,close_btn:null},{title:"debug info",width:600,height:500});i.makeLabel(c,null,"gui-time = "+X.toFixed(2)),i.makeLabel(c,null,"frt = "+j.toFixed(4)),i.makeLabel(c,null,"active loc = "+f.active_widget_loc),i.makeLabel(c,null,"resizing = "+f.resizing_window),i.makeLabel(c,null,"moving wind = "+f.moving_window),i.makeLabel(c,null,"make_dt = "+Q.toFixed(4)),i.makeLabel(c,null,"action_dt = "+Z.toFixed(4)),i.makeLabel(c,null,"render_dt = "+tt.toFixed(4)),i.makeLabel(c,null,"active windows = "+f.window_active),i.makeLabel(c,null,"minim windows = "+f.window_minimised),i.makeLabel(c,null,"frame act = "+JSON.stringify(f.mouse_frame));const s=e.makeWindow(c,f,{window:0,header:0,resizeable:null,close_btn:null},{title:"color picker test",width:300,height:380,x:800,y:100}),n=d.calcWidth(s.bbox)-2*l.layout_commons.padding-2*l.layout_commons.widget_gap,a=s.makeColorPickerRect(11,_.fromHex(l.widget.default_bg_color),n+2*l.layout_commons.widget_gap,300),h=s.makeDraggable(c,13,"H: "+Math.round(_.toHSVA(g).h),{width:1/3*n});s.cursor.x=h.bbox.right+l.layout_commons.widget_gap,s.cursor.y=h.bbox.top;const w=s.makeDraggable(c,14,"S: "+W(_.toHSVA(g).s,2),{width:1/3*n});s.cursor.x=w.bbox.right+l.layout_commons.widget_gap,s.cursor.y=w.bbox.top;const u=s.makeDraggable(c,15,"V: "+W(_.toHSVA(g).v,2),{width:1/3*n});s.cursor.x=u.bbox.right+l.layout_commons.widget_gap,s.cursor.y=u.bbox.top,s.resetCursor();const x=s.makeDraggable(c,16,"R: "+Math.round(g.r),{width:1/3*n});s.cursor.x=x.bbox.right+l.layout_commons.widget_gap,s.cursor.y=x.bbox.top;const p=s.makeDraggable(c,17,"G: "+Math.round(g.g),{width:1/3*n});s.cursor.x=p.bbox.right+l.layout_commons.widget_gap,s.cursor.y=p.bbox.top,s.makeDraggable(c,18,"B: "+Math.round(g.b),{width:1/3*n});for(let z=0;z<$;z++)if(z==0){const b=e.makeWindow(c,f,{window:0,header:0,resizeable:0,close_btn:null},{title:"window 1",x:100,y:100}),I=d.calcWidth(b.bbox)-2*l.layout_commons.padding;b.makeButton(c,1,"Increment"),b.makeButton(c,2,"Decrement");const S=b.makeLabel(c,null,"Drag some arbitrary number:");b.cursor.y=S.bbox.top,b.cursor.x=S.bbox.right+l.layout_commons.widget_gap,b.makeDraggable(c,4,"number = "+A).bbox.bottom=S.bbox.bottom,b.resetCursor(),b.makeDraggable(c,5,"Wrap width: "+H,{width:I}),b.makeLabel(c,null," "),b.makeButton(c,3,"Add a window. "+$),b.makeText(c,1,"Some more standard placeholder text that isn't some weird loremm ipsum shit that everyone is tired of.",H),b.makeButton(c,10,"Toggle window 1"),b.makeLabel(c,null," "),b.makeLabel(c,null,"* Grid => ");const y=U.makeGrid(b,0,3,1);y.makeDraggable(c,5,"g00"),y.makeDraggable(c,4,"g10"),y.makeDraggable(c,4,"g20"),y.makeDraggable(c,4,"g01"),y.makeDraggable(c,4,"g11"),y.makeDraggable(c,4,"g21"),y.makeDraggable(c,4,"g02"),y.makeDraggable(c,4,"g12"),y.makeDraggable(c,6,"g22"),b.resetCursor(),b.makeLabel(c,null,"Testing text after grid"),b.makeLabel(c,null," "),b.makeLabel(c,null,"* bg color: ");const k=" ",M=1/3*(I-2*l.layout_commons.widget_gap),O=b.makeDraggable(c,7,k+"R: "+g.r+k,{width:M});b.cursor.x=O.bbox.right+l.layout_commons.widget_gap,b.cursor.y=O.bbox.top;const P=b.makeDraggable(c,8,k+"G: "+g.g+k,{width:M});b.cursor.x=P.bbox.right+l.layout_commons.widget_gap,b.cursor.y=P.bbox.top,b.makeDraggable(c,9,k+"B: "+g.b+k,{width:M}),b.resetCursor(),b.makeLabel(c,null,"testing after rgb")}else if(z==1){const b=e.makeWindow(c,f,{window:0,header:0,resizeable:0,close_btn:0},{title:"test window with different layout modes",x:400,y:100}),[I]=[d.calcWidth(b.bbox)-l.layout_commons.padding,d.calcHeight(b.bbox)-2*l.layout_commons.padding],S=Math.min(600,Math.max(300,I))/2;b.makeDraggable(c,16,"Drag for bg r"),b.makeLabel(c,null,"Two column mode: "),b.setMode("two columns",{min_width:300,max_width:600}),b.makeLabel(c,null,"some left side text"),b.makeLabel(c,null,"some right text"),b.makeButton(c,1,"Increment",{width:100,height:50}),b.makeButton(c,2,"Decrement"),m=b.makeColorPickerRect(12,g,S,S),b.makeText(c,null,"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",S-10)}Q=performance.now()-o;const F=performance.now(),N=e.requestAction(f);switch(Z=performance.now()-F,N.action){case 1:A++;break;case 2:A--;break;case 3:$++;break;case 4:A+=f.mouse_delta_pos.x,A<-100&&(A=-100),A>100&&(A=100);break;case 5:H+=f.mouse_delta_pos.x,H<0&&(H=0);break;case 6:H+=2*f.mouse_delta_pos.x,H<0&&(H=0);break;case 7:g.r+=f.mouse_delta_pos.x;break;case 8:g.g+=f.mouse_delta_pos.x;break;case 9:g.b+=f.mouse_delta_pos.x;break;case 10:f.window_active[2]=!f.window_active[2];break;case 11:l.widget.default_bg_color=_.toHex(a.color);break;case 13:let{h:z,s:b,v:I,a:S}=_.toHSVA(g);z=B(z,f,1),g=_.fromHSVA(z,b,I,S);break;case 14:let{h:y,s:k,v:M,a:O}=_.toHSVA(g);k=B(k,f,.005,{min:0,max:1}),g=_.fromHSVA(y,k,M,O);break;case 15:let{h:P,s:nt,v:J,a:lt}=_.toHSVA(g);J=B(J,f,.005,{min:0,max:1}),g=_.fromHSVA(P,nt,J,lt);break;case 16:g.r=B(g.r,f,1,{min:0,max:255});break;case 17:g.g=B(g.g,f,1,{min:0,max:255});break;case 18:g.b=B(g.b,f,1,{min:0,max:255});break;case 12:m!=null&&(g=m.color)}const st=performance.now();c.clearRect(0,0,v.width,v.height),e.stack_render(c,f),tt=performance.now()-st,f.end();const V=performance.now();X=V-t,j=V-K,K=V,requestAnimationFrame(ot)}ot();
